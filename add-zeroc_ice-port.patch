From 5a0daa048e7f50eca915a5c4b1ebf21dbe9dacc6 Mon Sep 17 00:00:00 2001
From: Nik Reist <zeroability@outlook.com>
Date: Mon, 16 Mar 2020 19:42:18 -0400
Subject: [PATCH] Add ZeroC Ice Port

---
 ports/zeroc-ice/CONTROL        |  9 +++++++
 ports/zeroc-ice/portfile.cmake | 48 ++++++++++++++++++++++++++++++++++
 2 files changed, 57 insertions(+)
 create mode 100644 ports/zeroc-ice/CONTROL
 create mode 100644 ports/zeroc-ice/portfile.cmake

diff --git a/ports/zeroc-ice/CONTROL b/ports/zeroc-ice/CONTROL
new file mode 100644
index 000000000..0a52b17ce
--- /dev/null
+++ b/ports/zeroc-ice/CONTROL
@@ -0,0 +1,9 @@
+Source: zeroc-ice
+Version: 3.7.3
+Homepage: https://github.com/zeroc-ice/ice
+Description: Comprehensive RPC framework with support for C++, CSharp, Java, JavaScript, Python and more.
+Build-Depends: bzip2 (!uwp), expat (!uwp), mcpp, lmdb (!uwp), openssl (!uwp), zlib (!uwp)
+
+Feature: cpp11
+Description: build C++11 libraries
+Build-Depends: bzip2, expat, mcpp, openssl, mcpp, zlib
diff --git a/ports/zeroc-ice/portfile.cmake b/ports/zeroc-ice/portfile.cmake
new file mode 100644
index 000000000..b3325aa12
--- /dev/null
+++ b/ports/zeroc-ice/portfile.cmake
@@ -0,0 +1,48 @@
+vcpkg_from_github(
+	OUT_SOURCE_PATH SOURCE_PATH
+	REPO mumble-voip/ice
+	REF 3.7
+	SHA512 12cebb53ad1a9271e7db8c12df5f2db9f8cbaec97b562596c4c592bd2449177b6927156100166b432b7e27b13f0d202155748691fd1e848eb6db815f16bcc57f
+)
+
+if("cpp11" IN_LIST FEATURES)
+	vcpkg_configure_cmake(
+		SOURCE_PATH ${SOURCE_PATH}
+		PREFER_NINJA
+		OPTIONS
+			-DBUILD_ICE_CXX=ON
+			-DBUILD_ICE_CPP11=ON
+	)
+else()
+	vcpkg_configure_cmake(
+		SOURCE_PATH ${SOURCE_PATH}
+		PREFER_NINJA
+		OPTIONS
+			-DBUILD_ICE_CXX=ON
+	)
+endif()
+
+vcpkg_install_cmake()
+
+vcpkg_copy_pdbs()
+
+file(INSTALL ${SOURCE_PATH}/cpp/include DESTINATION ${CURRENT_PACKAGES_DIR})
+file(INSTALL ${SOURCE_PATH}/slice DESTINATION ${CURRENT_PACKAGES_DIR})
+file(INSTALL ${CURRENT_BUILDTREES_DIR}/${TARGET_TRIPLET}-rel/include 
+	DESTINATION ${CURRENT_PACKAGES_DIR}
+)
+
+if(EXISTS ${CURRENT_PACKAGES_DIR}/bin)
+	file(INSTALL ${CURRENT_PACKAGES_DIR}/bin/ DESTINATION ${CURRENT_PACKAGES_DIR}/tools/Ice)
+endif()
+
+file(INSTALL ${CURRENT_BUILDTREES_DIR}/${TARGET_TRIPLET}-rel/icebuilder/bin/ DESTINATION ${CURRENT_PACKAGES_DIR}/tools/Ice)
+
+vcpkg_copy_tool_dependencies(${CURRENT_PACKAGES_DIR}/tools/Ice)
+
+file(REMOVE_RECURSE ${CURRENT_PACKAGES_DIR}/bin ${CURRENT_PACKAGES_DIR}/debug/bin)
+
+file(REMOVE_RECURSE ${CURRENT_PACKAGES_DIR}/debug/include)
+  
+file(INSTALL ${SOURCE_PATH}/LICENSE DESTINATION ${CURRENT_PACKAGES_DIR}/share/${PORT} RENAME copyright)
+file(INSTALL ${SOURCE_PATH}/ICE_LICENSE DESTINATION ${CURRENT_PACKAGES_DIR}/share/${PORT})
\ No newline at end of file
-- 
2.25.1.windows.1

